## Алгоритм обработки запроса POST /user/{user_id}/task/
Описывает логику сервиса задач при обработке запроса, инициирующего создание новой задачи. 

### Входные данные

| Поле | Тип данных | Ограничения | Описание |
|---|---|---|---|
| user_id | UUID | NOT NULL| ID пользователя (передается в path) |
| title | string | NOT NULL | Название задачи |
| description | string | NOT NULL | Описание задачи |
| deadline | TIMESTAMP | CHECK(TIMEDIFF(deadline, NOW()) > 0) | Дедлайн задачи |
| tags | string array | - | Массив тегов |
| x-Idempotency-key | string | - | Ключ идемпотентности (передается в header) |

### Выходные данные

| Поле          | Тип данных| Описание                                                                           |
| ------------- |---| ---------------------------------------------------------------------------------- |
| user_id | UUID | ID пользователя из входных данных|
| title | string | Название задачи из входных данных|
| description | string | Описание задачи из входных данных|
| deadline | TIMESTAMP | Дедлайн задачи из входных данных|
| tags | string array | Массив тегов из входных данных|
| created_at | TIMESTAMP | Время создания задачи|

### Алгоритм работы

<ol>
   <li>Логическая проверка данных:</li>
      <ul>
         <li>Если время в deadline из входных параметров раньше чем текущее время, завершить алгоритм и выбросить ошибку 400.</li>
         <li>Если запрос с таким же ключом идемпотентности уже поступал - завершить алгоритм, вернуть ответ прошлого запроса</li>   
      </ul>
   <li>Вставить запись в таблицу Task БД task_service</li>
   <li>
      <table>
          <tr>
              <td>Поле</td>
              <td>Чем заполнять</td>
          </tr>
          <tr>
              <td>user_id</td>
              <td>user_id из входных параметров</td>
          </tr>
          <tr>
              <td>title</td>
              <td>title из входных параметров</td>
          </tr>
          <tr>
              <td>description</td>
              <td>description из входных параметров</td>
          </tr>
          <tr>
              <td>deadline</td>
              <td>deadline из входных параметров</td>
          </tr>
          <tr>
              <td>tags</td>
              <td>tags из входных параметров</td>
          </tr>
          <tr>
              <td>created_at</td>
              <td>Текущая дата и время - NOW()</td>
          </tr>
      </table>
   </li>
   <li>Если поле tags содержит данные, то:</li>
      <ul>
         <li>Получить ID созданной задачи из таблицы Task</li>
         <li>Получить ID тегов на основе имен тегов из входных данных</li>
         <li>Если полученных тегов меньше, то вставить в таблицу Tags БД task_service записи недостающих тегов</li>
         <li>
            <table>
                <tr>
                    <td>Поле</td>
                    <td>Чем заполнять</td>
                </tr>
                <tr>
                    <td>name</td>
                    <td>названия недостающих тегов из входных параметров </td>
                </tr>
            </table>
         </li>
         <li>Получить ID всех тегов из поля tags входных параметров</li>
         <li>Вставить в таблицу Task_Tag записи, присвоив созданной задаче теги из входных параметров</li>
         <li>
            <table>
               <tr>
                 <td>Поле</td>
                 <td>Чем заполнять</td>
               </tr>
               <tr>
                 <td>task_id</td>
                 <td>ID созданной задачи</td>
               </tr>
               <tr>
                 <td>tag_id</td>
                 <td>ID тегов из поля tags входных параметров</td>
               </tr>
            </table>
         </li>
      </ul>
</ol>
5. Сохранение запроса с ключом идемпотентности. <br>
6. Формирование HTTP-ответа на запрос.

### Ошибки

| Error code | error-message        | Сообщение ошибки                                |
| ---------- | -------------------- | ----------------------------------------------- |
| 400        | invalid_request_data | Входные параметры не прошли валидацию |
| 403        | forbidden_origin     | Запрос не прошёл проверку доверенного источника |
| 500        | db_insert_failed     | Не удалось добавить пользователя в базу данных  |

